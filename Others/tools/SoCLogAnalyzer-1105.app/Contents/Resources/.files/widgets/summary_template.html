<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title>Summary</title>
    <meta name="author" content="SoCLogAnalyzer">
    <link rel="stylesheet" href="../css/bootstrap4.1.3.min.css">
    <link rel="stylesheet" href="../css/summary.css">
</head>
<body data-isdict="{{isdict|lower}}" data-basedir="{{tc1Value}}" >

    {# 返回顶部 #}
    <div id="gotop" href="#" class="scrollup">
        <div style="position:absolute;bottom:0">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-arrow-up-circle-fill" viewBox="0 0 16 16">
                <path d="M16 8A8 8 0 1 0 0 8a8 8 0 0 0 16 0zm-7.5 3.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V11.5z"/>
            </svg>
        </div>
    </div>

    <div id="info_bar" {{countDown}}>
        <div>
            <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16">
                    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                </svg>
            </span>
            <span class="msg">This folder may be generated by Atlas2, so only *base_uart.log is loaded. Do you want to load it all?</span>
        </div>
        <div>
            <button id="show_more_btn" class="btn btn-outline-dark btn-sm" data-countdown="15" onclick="$('#info_bar').hide();setTimeout(()=>window.location.href='#LoadAll', 10)">Load all (15)</button>
            <a href="#" style="padding: 0 5px;" title="close" onclick="$('#info_bar').slideUp(300);event.stopImmediatePropagation()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle-fill" viewBox="0 0 16 16">
                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"/>
                </svg>
            </a>
        </div>
    </div>

    {# head #}
    <div name='summary' style="margin: 10px 30px;">
        <h4>Summary</h4>
        <h6>Basic information:</h6>
        <ul>
            <li>
                <p>Loop sign: {{ tc2Value|default('Empty', true) }}</p>
            </li>            
            <li>
                {%- if isdict %}
                <div style="display: inline-flex;">
                    <span style="padding-right:10px">Folder&nbsp;Path: </span>
                    <p class="text-break long-text">{{ tc1Value }}</p>
                </div>
                <ul class="many-txt serial_number">
                    {%- for i in log_dict.keys() %}
                    {%- if loop.index >5 %}
                    <li class="item hidden_item"><code><a href="{{ i | md5('#file') }}" name="{{ i | md5 }}">{{ i|relpath(tc1Value) }}</a></code></li>
                    {%- else %}
                    <li class="item"><code><a href="{{ i | md5('#file') }}" name="{{ i | md5 }}">{{ i|relpath(tc1Value) }}</a></code></li>
                    {%- endif  %}
                    {%- if loop.last and loop.length > 5 %}
                    <a href="#" class="expand-btn" data-status="collapse">Expand...</a>
                    {%- endif %}
                    {%- endfor %}
                </ul>
                {%- else %}
                <div style="display: inline-flex;">
                    <span style="padding-right:10px">Log&nbsp;path: </span>
                    <p class="text-break">{{ tc1Value }}</p>
                </div>
                {%- endif %}
            </li>
        </ul>

        {# TestPlan information #}
        <h6>TestPlan information:</h6>
        {%- if isdict %}
        <ul class="many-txt">
            {%- if TP_info %}
            {%- for k, v in TP_info.items() %}
            {%- if loop.index >5 %}
            <li class="item hidden_item" name="{{ k | md5 }}">
                <span>{{ k|relpath(tc1Value) }}:</span>
                <code>{{ v | default('Unknown', true) }}</code>
            </li>
            {%- else %}
            <li class="item" name="{{ k | md5 }}">
                <span>{{ k|relpath(tc1Value) }}:</span>
                <code>{{ v | default('Unknown', true) }}</code>
            </li>
            {%- endif  %}
            {%- if loop.last and loop.length > 5 %}
            <a href="#" class="expand-btn" data-status="collapse">Expand...</a>
            {%- endif %}
            {%- endfor %}
            {%- else %}
            <li class="item"><code>Unknown</code></li>
            {%- endif %}
        </ul>
        {%- else %}
        <ul>
            {%- if TP_info %}
            <li>Info: <code>{{ TP_info }}</code></li>
            {%- else %}
            <li>Info: <code>Unknown</code></li>
            {%- endif %}
        </ul>
        {%- endif %}
        <hr>
    </div>

    {# body #}
    <div name='file' style="margin: 10px 30px;">
        {%- for k, v in log_dict.items() %}
        {%- with k_md5 = k | md5  %}
        <div name='{{ k_md5 }}' data-logpath="{{k}}">
            <h6 id="file{{k_md5 }}">{{ k|relpath(tc1Value) }}</h6>
            <ul>
                {# Version information #}
                <li style="margin-bottom: 2rem;">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th colspan="2">Version information</th>
                                <th colspan="2">Parsed commands in logfile information</th>
                            </tr>
                        </thead>
                        <tbody>
                            {%- with iboot, rtos, rbm = v.ver.version %}
                            <tr>
                                <th scope="row">iBoot Version</th>
                                <td>{{ iboot }}</td>
                                <th scope="row">All</th>
                                <td>{{ v.pass_count+v.fail_count }}</td>
                            <tr>
                                <th scope="row">Rtos Version</th>
                                <td>{{ rtos|default('Null', true) }}</td>
                                <th scope="row">Pass</th>
                                <td>{{ v.pass_count }}</td>
                            </tr>
                            <tr>
                                <th scope="row">Rbm Version</th>
                                <td>{{ rbm }}</td>
                                <th scope="row">Fail</th>
                                <td style="color: red;">{{ v.fail_count }} (Hang: {{ v.hang_count }})</td>
                            </tr>
                            {%- endwith %}
                        </tbody>
                    </table>

                    {# Parsed loops in logfile information #}
                    {%- if v.get_loops() %}
                    <table class="table table-bordered">
                        <thead>
                            <tr role="row">
                                <th colspan="5">Parsed loops in logfile information</th>
                            </tr>
                            <tr role="row">
                                <th>TotalLoops</th>
                                <th>Contain</th>
                                <th>Pass</th>
                                <th>Fail</th>
                                <th>Hang</th>
                            </tr>
                        </thead>
                        <tbody>
                            {%- for l in v.get_loops() %}
                            <tr>
                                <td>{{ l.name }}</td>
                                <td>{{ l.commandsInfo.totalCommands }}</td>
                                <td>{{ l.commandsInfo.totalPass }}</td>
                                <td>{{ l.commandsInfo.totalFail }}</td>
                                <td>{{ l.commandsInfo.totalHang }}</td>
                            </tr>
                            {%- endfor %}
                        </tbody>
                    </table>
                    {%- endif %}
                </li>

                {# The total test time of Rtos #}
                {%- with length, Rtos_used_time, items = v.get_groups_time('Rtos') -%}
                {%- if Rtos_used_time >= 0 %}
                <li>
                    <span class="cmd_category">
                        Contains
                        <span style="color: #FFA726;font-weight: 800">{{ length }} Rtos</span>  
                        tests, with a total time of 
                        <span class="hint" style="color: #FFA726;font-weight: 800">{{ Rtos_used_time }}</span>  
                        seconds. The ten tests that consume the most time are:
                    </span>
                    <table id="{{ k_md5 }}_TB_RTOS" class="table table-striped">
                        <thead>
                            <tr>
                                <th data-sortas="numeric">Index</th>
                                <th data-sortas="numeric">Time/s</th>
                                <th data-sortas="case-insensitive">Command</th>
                                <th class="loading">Chart</th>
                            </tr>
                        </thead>
                        <tbody>
                            {%- for i in items -%}
                                {%- with -%}
                                    {%- if i.status -%}
                                        {%- set style = '' -%}
                                    {%- else -%}
                                        {%- set style = 'fail' -%}
                                    {%- endif-%}
                                    <tr class="{{style}}" class='cmd-item'>
                                        <td>{{ i.number }}</td>
                                        <td>{{ i.used_time|round(3) }}</td>
                                        <td data-href="#{{ i.id }}&&{{i.number}}" title="Show details">{{ i.name }}</td>
                                        <td data-uuid="{{ i.id }}"></td>
                                    </tr>
                                {%- endwith -%}
                            {%- endfor -%}
                        </tbody>
                    </table>
                </li>
                {%- endif -%}
                {%- endwith -%}

                {# The total test time of Rbm #}
                {%- with length, Rbm_used_time, items = v.get_groups_time('Rbm') -%}
                {%- if Rbm_used_time >= 0 %}
                <li>
                    <span class="cmd_category">
                        Contains
                        <span style="color: #26A69A;font-weight: 800">{{ length }} Rbm</span>  
                        tests, with a total time of 
                        <span class="hint" style="color: #26A69A;font-weight: 800">{{ Rbm_used_time|default('Null (no time stamp information)', True) }}</span>  
                        seconds. The ten tests that consume the most time are:
                    </span>
                    <table id="{{ k_md5 }}_TB_RBM" class="table table-striped">
                        <thead>
                            <tr>
                                <th data-sortas="numeric">Index</th>
                                <th data-sortas="numeric">Time/s</th>
                                <th data-sortas="case-insensitive">Command</th>
                                <th class="loading">Chart</th>
                            </tr>
                        </thead>
                        <tbody>
                            {%- for i in items -%}
                                {%- with -%}
                                    {%- if i.status -%}
                                        {%- set style = '' -%}
                                    {%- else -%}
                                        {%- set style = 'fail' -%}
                                    {%- endif-%}
                                    <tr class="{{style}}" class='cmd-item'>
                                        <td>{{ i.number }}</td>
                                        <td>{{ i.used_time|round(3) }}</td>
                                        <td data-href="#{{ i.id }}&&{{i.number}}" title="Show details">{{ i.name }}</td>
                                        <td data-uuid="{{ i.id }}"></td>
                                    </tr>
                                {%- endwith -%}
                            {%- endfor -%}
                        </tbody>
                    </table>
                </li>
                {%- endif -%}
                {%- endwith -%}

                {# The total test time of Phleet #}
                {%- with length, Phleet_used_time, items = v.get_groups_time('Phleet') -%}
                {%- if Phleet_used_time >= 0 %}
                <li>
                    <span class="cmd_category">
                        Contains
                        <span style="color: #AB47BC;font-weight: 800">{{ length }} Phleet</span>  
                        tests, with a total time of 
                        <span class="hint" style="color: #AB47BC;font-weight: 800">{{ Phleet_used_time }}</span>  
                        seconds. The ten tests that consume the most time are:
                    </span>

                    <table id="{{ k_md5 }}_TB_PHLEET" class="table table-striped">
                        <thead>
                            <tr>
                                <th data-sortas="numeric">Index</th>
                                <th data-sortas="numeric">Time/s</th>
                                <th data-sortas="case-insensitive">Command</th>
                                <th class="loading">Chart</th>
                            </tr>
                        </thead>
                        <tbody>
                            {%- for i in items -%}
                                {%- with -%}
                                    {%- if i.status -%}
                                        {%- set style = '' -%}
                                    {%- else -%}
                                        {%- set style = 'fail' -%}
                                    {%- endif-%}
                                    <tr class="{{style}}" class='cmd-item'>
                                        <td>{{ i.number }}</td>
                                        <td>{{ i.used_time|round(3) }}</td>
                                        <td data-href="#{{ i.id }}&&{{i.number}}" title="Show details">{{ i.name }}</td>
                                        <td data-uuid="{{ i.id }}"></td>
                                    </tr>
                                {%- endwith -%}
                            {%- endfor -%}
                        </tbody>
                    </table>
                </li>
                {%- endif -%}
                {%- endwith -%}

            </ul>
            <hr>
        </div>
        {%- endwith -%}
        {%- endfor %}
    </div>

    <script src="../js/jquery-3.5.1.min.js"></script>
    <script src="../js/fancyTable.js"></script>
    <script src="../js/summary.js"></script>

</body>
</html>